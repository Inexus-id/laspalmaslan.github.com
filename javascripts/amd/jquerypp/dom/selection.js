/*
* jQuery++ - 1.0.0 (2012-11-23)
* http://jquerypp.com
* Copyright (c) 2012 Bitovi
* Licensed MIT
*/
define(["jquery","jquerypp/dom/range"],function(e){var t=function(e){return e?e.ownerDocument.defaultView||e.ownerDocument.parentWindow:window},n=function(t,n){var r=e.Range.current(t).clone(),i=e.Range(t).select(t);return r.overlaps(i)?(r.compare("START_TO_START",i)<1?(startPos=0,r.move("START_TO_START",i)):(fromElementToCurrent=i.clone(),fromElementToCurrent.move("END_TO_START",r),startPos=fromElementToCurrent.toString().length),r.compare("END_TO_END",i)>=0?endPos=i.toString().length:endPos=startPos+r.toString().length,{start:startPos,end:endPos,width:endPos-startPos}):null},r=function(r){var i=t(r);if(r.selectionStart!==undefined)return document.activeElement&&document.activeElement!=r&&r.selectionStart==r.selectionEnd&&r.selectionStart==0?{start:r.value.length,end:r.value.length,width:0}:{start:r.selectionStart,end:r.selectionEnd,width:r.selectionEnd-r.selectionStart};if(i.getSelection)return n(r,i);try{if(r.nodeName.toLowerCase()=="input"){var s=t(r).document.selection.createRange(),o=r.createTextRange();o.setEndPoint("EndToStart",s);var u=o.text.length;return{start:u,end:u+s.text.length,width:s.text.length}}var a=n(r,i);if(!a)return a;var f=e.Range.current().clone(),l=f.clone().collapse().range,c=f.clone().collapse(!1).range;return l.moveStart("character",-1),c.moveStart("character",-1),a.startPos!=0&&l.text==""&&(a.startPos+=2),a.endPos!=0&&c.text==""&&(a.endPos+=2),a}catch(h){return{start:r.value.length,end:r.value.length,width:0}}},i=function(e,n,r){var i=t(e);if(e.setSelectionRange)r===undefined?(e.focus(),e.setSelectionRange(n,n)):(e.select(),e.selectionStart=n,e.selectionEnd=r);else if(e.createTextRange){var s=e.createTextRange();s.moveStart("character",n),r=r||n,s.moveEnd("character",r-e.value.length),s.select()}else if(i.getSelection){var u=i.document,a=i.getSelection(),f=u.createRange(),l=[n,r!==undefined?r:n];o([e],l),f.setStart(l[0].el,l[0].count),f.setEnd(l[1].el,l[1].count),a.removeAllRanges(),a.addRange(f)}else if(i.document.body.createTextRange){var f=document.body.createTextRange();f.moveToElementText(e),f.collapse(),f.moveStart("character",n),f.moveEnd("character",r!==undefined?r:n),f.select()}},s=function(e,t,n,r){typeof n[0]=="number"&&n[0]<t&&(n[0]={el:r,count:n[0]-e}),typeof n[1]=="number"&&n[1]<=t&&(n[1]={el:r,count:n[1]-e})},o=function(e,t,n){var r,i;n=n||0;for(var u=0;e[u];u++)r=e[u],r.nodeType===3||r.nodeType===4?(i=n,n+=r.nodeValue.length,s(i,n,t,r)):r.nodeType!==8&&(n=o(r.childNodes,t,n));return n};return e.fn.selection=function(e,t){return e!==undefined?this.each(function(){i(this,e,t)}):r(this[0])},e.fn.selection.getCharElement=o,e});